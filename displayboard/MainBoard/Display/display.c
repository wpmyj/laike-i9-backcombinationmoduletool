/****************************************************************************************************/
/*			@FileName		:	display.c															  	*/
/*			@Author			:	zhengbaiqiu															*/
/*			@Version		:	v1.0																*/
/*			@Date			:	2019.11.12  														*/
/****************************************************************************************************/


/* Includes --------------------------------------------------------------------*/
#include "stm32f10x.h"

/* Project ---------------------------------------------------------------------*/
#include "maindef.h"
//#include "font.h"
#include "lcd_driver.h"	
#include "gui.h"	
#include "delay.h"
#include "display.h"
#include "apiLib.h"

/* Variable --------------------------------------------------------------------*/
extern u16 Touch_X;
extern u16 Touch_Y;

/* Function --------------------------------------------------------------------*/
void DrawTestPage(u8 *str);
void Test_Display(void);





/*****************************************************************************
 * @name       :void DrawTestPage(u8 *str)
 * @date       :2018-08-09 
 * @function   :Drawing test interface
 * @parameters :str:the start address of the Chinese and English strings
 * @retvalue   :None
******************************************************************************/ 
void DrawTestPage(u8 *str)
{
	//绘制固定栏up
	//LCD_Clear(WHITE);
	LCD_Clear(GRAY0);
	LCD_Fill(0,0,lcddev.width,20,BLUE);
	//绘制固定栏down
// 	LCD_Fill(0,20,lcddev.width,40,YELLOW);
//	LCD_Fill(0,230,lcddev.width,250,BLUE);
	LCD_Fill(0,lcddev.height-20,lcddev.width,lcddev.height,BLUE);
	POINT_COLOR=WHITE;
	//POINT_COLOR=GRAY0;
	Gui_StrCenter(0,2,WHITE,BLUE,str,16,1);//居中显示
// 	Gui_StrCenters(0,22,BLACK,YELLOW,"检测栏",16,1);//居中显示
// 	Gui_StrCenters(241,22,BLACK,YELLOW,"检测栏",16,1);//居中显示
// 	Gui_StrCenters(0,232,WHITE,BLUE,"测试状态",16,1);//居中显示
// 	Gui_StrCenters(241,232,WHITE,BLUE,"预留",16,1);//居中显示
//	Gui_DrawLine(240,250,240,300,BLUE);
//	LCD_DrawLine(240,40,240,300);
	//Gui_StrCenter(0,lcddev.height-18,WHITE,BLUE,"http://www.zbq.com",16,1);//居中显示
	Gui_StrCenter(0,lcddev.height-18,WHITE,BLUE,"请按提示操作",16,1);//居中显示
	//绘制测试区域
	//LCD_Fill(0,20,lcddev.width,lcddev.height-20,WHITE);
}

/*****************************************************************************
 * @name       :void Display_Test(u8 test_mode,u8 test_cmd,u8 test_status)
 * @date       :2020-09-19 
 * @author     :zhengbaiqiu 
 * @function   :display test
 * @parameters :test_cmd 读取到的命令码
 * @retvalue   :None
******************************************************************************/
void Display_Test(u8 test_mode,u8 test_cmd,u8 test_status,u16 dat1,u16 dat2)
{
	if(test_cmd == 1)
	{
		Gui_DrawFont_Num16(116,50,BLACK,GRAY0,dat1);
		Gui_DrawFont_Num16(198,50,BLACK,GRAY0,dat2);
	}
	else if(test_cmd == 2)
	{
		Gui_DrawFont_Num16(116,80,BLACK,GRAY0,dat1);
		Gui_DrawFont_Num16(198,80,BLACK,GRAY0,dat2);
	}
	
	
// 	switch(test_cmd)
// 	{
// 		case TEST_START ://01
// 			if(test_status == 1)
// 			{
// 				//Gui_DrawFont_GBK24(300,245,GREEN,GRAY0,"检测中...");
// 			}
// 			break;
// 		case TEST_LEFT_GUIDE ://02
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,44,BLACK,GRAY0,"左引导");
// 				//Gui_DrawFont_GBK16(0,42,BLACK,GRAY0,"左引导PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,44,RED,GRAY0,"左引导");
// 				//Gui_DrawFont_GBK16(0,42,RED,GRAY0,"左引导FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,68,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_TOP_GUIDE ://03
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,68,BLACK,GRAY0,"上引导");
// 				//Gui_DrawFont_GBK16(0,62,BLACK,GRAY0,"上引导PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,68,RED,GRAY0,"上引导");
// 				//Gui_DrawFont_GBK16(0,62,RED,GRAY0,"上引导FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,92,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_GUIDE ://04
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,92,BLACK,GRAY0,"前引导");
// 				//Gui_DrawFont_GBK16(0,82,BLACK,GRAY0,"前引导PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,92,RED,GRAY0,"前引导");
// 				//Gui_DrawFont_GBK16(0,82,RED,GRAY0,"前引导FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,116,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_RIGHT_GUIDE ://05
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,116,BLACK,GRAY0,"右引导");
// 				//Gui_DrawFont_GBK16(0,102,BLACK,GRAY0,"右引导PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,116,RED,GRAY0,"右引导");
// 				//Gui_DrawFont_GBK16(0,102,RED,GRAY0,"右引导FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,140,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_LEFT_AVOID_BUMP ://06
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,140,BLACK,GRAY0,"左免碰撞");
// 				//Gui_DrawFont_GBK16(0,122,BLACK,GRAY0,"左免碰撞PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,140,RED,GRAY0,"左免碰撞");
// 				//Gui_DrawFont_GBK16(0,122,RED,GRAY0,"左免碰撞FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,164,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP0 ://07
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,164,BLACK,GRAY0,"中免碰撞0");
// 				//Gui_DrawFont_GBK16(0,142,BLACK,GRAY0,"中免碰撞0PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,164,RED,GRAY0,"中免碰撞0");
// 				//Gui_DrawFont_GBK16(0,142,RED,GRAY0,"中免碰撞0FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,188,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP1 ://08
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,188,BLACK,GRAY0,"中免碰撞1");
// 				//Gui_DrawFont_GBK16(0,162,BLACK,GRAY0,"中免碰撞1PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,188,RED,GRAY0,"中免碰撞1");
// 				//Gui_DrawFont_GBK16(0,162,RED,GRAY0,"中免碰撞1FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,212,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP2 ://09
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,212,BLACK,GRAY0,"中免碰撞2");
// 				//Gui_DrawFont_GBK16(0,182,BLACK,GRAY0,"中免碰撞2PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,212,RED,GRAY0,"中免碰撞2");
// 				//Gui_DrawFont_GBK16(0,182,RED,GRAY0,"中免碰撞2FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,236,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP3 ://10
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,236,BLACK,GRAY0,"中免碰撞3");
// 				//Gui_DrawFont_GBK16(0,202,BLACK,GRAY0,"中免碰撞3PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,236,RED,GRAY0,"中免碰撞3");
// 				//Gui_DrawFont_GBK16(0,202,RED,GRAY0,"中免碰撞3FAIL");
// 			}
// 			Gui_DrawFont_GBK24(0,260,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP4 ://11
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(0,260,BLACK,GRAY0,"中免碰撞4");
// 				//Gui_DrawFont_GBK16(0,222,BLACK,GRAY0,"中免碰撞4PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(0,260,RED,GRAY0,"中免碰撞4");
// 				//Gui_DrawFont_GBK16(0,222,RED,GRAY0,"中免碰撞4FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,44,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP5 ://12
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,44,BLACK,GRAY0,"中免碰撞5");
// 				//Gui_DrawFont_GBK16(0,242,BLACK,GRAY0,"中免碰撞5PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,44,RED,GRAY0,"中免碰撞5");
// 				//Gui_DrawFont_GBK16(0,242,RED,GRAY0,"中免碰撞5FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,68,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP6 ://13
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,68,BLACK,GRAY0,"中免碰撞6");
// 				//Gui_DrawFont_GBK16(0,262,BLACK,GRAY0,"中免碰撞6PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,68,RED,GRAY0,"中免碰撞6");
// 				//Gui_DrawFont_GBK16(0,262,RED,GRAY0,"中免碰撞6FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,92,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP7 ://14
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,92,BLACK,GRAY0,"中免碰撞7");
// 				//Gui_DrawFont_GBK16(0,282,BLACK,GRAY0,"中免碰撞7PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,92,RED,GRAY0,"中免碰撞7");
// 				//Gui_DrawFont_GBK16(0,282,RED,GRAY0,"中免碰撞7FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,116,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP8 ://15
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,116,BLACK,GRAY0,"中免碰撞8");
// 				//Gui_DrawFont_GBK16(241,42,BLACK,GRAY0,"中免碰撞8PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,116,RED,GRAY0,"中免碰撞8");
// 				//Gui_DrawFont_GBK16(241,42,RED,GRAY0,"中免碰撞8FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,140,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_FRONT_AVOID_BUMP9 ://16
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,140,BLACK,GRAY0,"中免碰撞9");
// 				//Gui_DrawFont_GBK16(241,62,BLACK,GRAY0,"中免碰撞9PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,140,RED,GRAY0,"中免碰撞9");
// 				//Gui_DrawFont_GBK16(241,62,RED,GRAY0,"中免碰撞9FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,164,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_RIGHT_AVOID_BUMP ://17
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,164,BLACK,GRAY0,"右免碰撞");
// 				//Gui_DrawFont_GBK16(241,82,BLACK,GRAY0,"右免碰撞PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,164,RED,GRAY0,"右免碰撞");
// 				//Gui_DrawFont_GBK16(241,82,RED,GRAY0,"右免碰撞FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,188,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_LEFT_ALONG_SIDE ://18
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,188,BLACK,GRAY0,"左沿边");
// 				//Gui_DrawFont_GBK16(241,102,BLACK,GRAY0,"左沿边PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,188,RED,GRAY0,"左沿边");
// 				//Gui_DrawFont_GBK16(241,102,RED,GRAY0,"左沿边FAIL");
// 			}
// 			Gui_DrawFont_GBK24(242,212,BLACK,GRAY0,"...");
// 			break;
// 		case TEST_RIGHT_ALONG_SIDE ://19
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,212,BLACK,GRAY0,"右沿边");
// 				//Gui_DrawFont_GBK16(241,122,BLACK,GRAY0,"右沿边PASS");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,212,RED,GRAY0,"右沿边");
// 				//Gui_DrawFont_GBK16(241,122,RED,GRAY0,"右沿边FAIL");
// 			}
// 			break;
// 		case 0xfe :
// 			if(test_status == 1)
// 			{
// 				Gui_DrawFont_GBK24(242,236,BLACK,GRAY0,"检测完成");
// 				//Gui_DrawFont_GBK24(300,245,GREEN,GRAY0,"检测OK");
// 			}
// 			else
// 			{
// 				Gui_DrawFont_GBK24(242,236,RED,GRAY0,"检测FAIL");
// 			}
// 			break;
// 		default :
// 			break;
// 	}
// 	Gui_DrawPoint(0,0,GRAY0);
}

/*****************************************************************************
 * @name       :void Test_Display(void)
 * @date       :2020-09-19 
 * @author     :zhengbaiqiu 
 * @function   :display test
 * @parameters :None
 * @retvalue   :None
******************************************************************************/
void Test_Display(void)
{
//	if(mMaininf.mWork.mWorkInitFlag == 1)//初始化成功
	if(1)
	{
// 		if(mMaininf.mWork.mWorkChecking == 0)//未在检测状态
// 		{
// 			if(mMaininf.mMode.mScreenPressFlag == 1)            //    屏幕触发
// 			{
// 				mMaininf.mMode.mScreenPressFlag = 0;
// 				
// 				if((Touch_X >= 305) && (Touch_X <= 423) && (Touch_Y >= 215) && (Touch_Y <= 278))
// 				{
// 					LCD_Clear_Area(305,215,423,278,GRAY0);
// 					
// 					Gui_DrawFont_GBK24(140,130,BLUE,GRAY0,"检测中..              ");
// 					
// 					api_SendCMDData(2,1,1);//开始检测
// 					mMaininf.mWork.mWorkChecking = 1;
// 				}
// 			}
// 		}
//		else
		if(1)
		{
			if(mMaininf.mUart1.mReceiveFlag == 1)            //    接收到反馈
			{
				mMaininf.mUart1.mReceiveFlag = 0;
				

				if(mMaininf.mUart1.ReceiveBuf[0] == 1)//接收到指令
				{
					mMaininf.mWork.mWorkDropDataFar = ((mMaininf.mUart1.ReceiveBuf[3] << 8) | mMaininf.mUart1.ReceiveBuf[4]);
					mMaininf.mWork.mWorkDropDataNear = ((mMaininf.mUart1.ReceiveBuf[5] << 8) | mMaininf.mUart1.ReceiveBuf[6]);
					
					Display_Test(1,mMaininf.mUart1.ReceiveBuf[1],mMaininf.mUart1.ReceiveBuf[2],mMaininf.mWork.mWorkDropDataFar,mMaininf.mWork.mWorkDropDataNear);
					
					api_SendCMDData(1,mMaininf.mUart1.ReceiveBuf[1],1);//返回信息
					vTaskDelay(5);
					mMaininf.mWork.mWorkChecking = 0;

				}
			}
			
		}
	}
	Gui_DrawPoint(0,0,GRAY0);
	
}






















